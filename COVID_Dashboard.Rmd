---
title: "COVID-19 Tracking"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    css: tables.css
    source_code: embed
---

```{r setup, include=FALSE}
options(scipen = 999)
library(flexdashboard)
library(plotly)
library(reactable)
library(crosstalk)
source("COVID_Data_Pull.R") # Pull in new data
```

State Summary {data-icon="ion-stats-bars"}
===================================== 

```{r filters}

```

Row {data-width=650}
-----------------------------------------------------------------------

### State Summary

```{r}
## TODO
# Add in last 7 day moving average sparkline (split by cases and deaths?)
today_state_data <- state_data %>% 
  filter(Date == today-1) %>% 
  ungroup() %>% 
  select(State, Cases, Deaths) %>% 
  arrange(desc(Cases))

reactable(
  data = today_state_data,
  sortable = TRUE,
  bordered = FALSE,
  fullWidth = TRUE,
  class = "covid_table",
  columns = list(
    Cases = colDef(format = colFormat(separators = TRUE)),
    Deaths = colDef(format = colFormat(separators = TRUE))
  )
)
```

### Daily Cases

```{r}
# Shared Data
plotly_data <- highlight_key(daily_country_data)
bscols(
  widths = c(3,NA),
  filter_select("State_List", "State/Territory", plotly_data, ~State, allLevels = FALSE, multiple = FALSE),
  plot_ly(
    data = plotly_data,
    x = ~Date,
    y = ~New_Cases,
    name = "Daily Cases",
    type = "bar",
    marker = list(color = 'rgb(158,202,225)')
    ) %>% add_trace(x = ~Date,
                    y = ~Rolling14Cases,
                    name = "Rolling 14-day Average",
                    type = "scatter",
                    mode = "lines+markers",
                    marker = list(color = "rgb(49,130,189)", opacity=0),
                    line = list(color = "rgb(49,130,189)", opacity=1)
                    ) %>% 
    layout(title = "Daily Cases",
           xaxis = list(title = "Date"),
           yaxis = list(title = ""),
           legend = list(x = 0.25, y = 1, orientation = "h")
           )
  )
```

Row {data-width=650}
-----------------------------------------------------------------------

### Daily Deaths

```{r}
#daily_deaths_fig <- plot_ly(
#  x = daily_data$Date,
#  y = daily_data$New_Deaths,
#  name = "Daily Deaths",
#  type = "bar",
#  marker = list(color = 'rgb(254,224,210)')
#  )
#daily_deaths_fig <- daily_deaths_fig %>% add_trace(x = daily_data$Date,
#                                                 y = daily_data$Rolling14Deaths,
#                                                 name = "Rolling 14-day Average",
#                                                 type = "scatter",
#                                                 mode = "lines+markers",
#                                                 marker = list(color = "rgb(222,45,38)", opacity=0),
#                                                 line = list(color = "rgb(222,45,38)", opacity=1)
#                                                 )
## Update Layout
#daily_deaths_fig <- daily_deaths_fig %>% 
#  layout(title = "Daily Deaths",
#         xaxis = list(title = "Date"),
#         yaxis = list(title = ""),
#         legend = list(x = 0.25, y = 1, orientation = "h")
#         )
#daily_deaths_fig
```

### Chart 4


#<script > $('input[name="SelYear"][value=2020]').attr("checked", true); </script>